dev gv

pipeline {   
    agent any
    tools{
        maven 'maven-3.9'
    }

    stages{ 

       stage("init"){
             steps{
                 script{
                     gv = load "script.groovy"    
                 }
              }
        }

        
        stage("build jar") {
                steps {
                    script{
                      gv.buildJar()
                   }
                }
        }
    
        stage("build image") {
                steps {
                    script{
                        echo "building the docker image..."
                        withCredentials([
                            usernamePassword(credentialsId: 'docker-hub-repo', passwordVariable: 'PWD', usernameVariable: 'USER')]){
                                    sh """
                                        cd java-maven-app/
                                        docker build -t lala011/demo-app:jma-2.0 .
                                        echo $PWD | docker login -u $USER --password-stdin
                                        docker push lala011/demo-app:jma-2.0
                                    """                               
                            }
                       
                    }
                }
        }
                 
        
    
        stage("deploy") {
            steps {
                script {
                    echo "deploying the application"
                }
            }
        }              
    }
} 

